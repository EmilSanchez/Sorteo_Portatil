<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Universitaria - Port√°til Gamer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce { animation: bounce 1s infinite; }
        
        body {
            background: linear-gradient(135deg, #4c1d95 0%, #1e3a8a 50%, #312e81 100%);
            min-height: 100vh;
        }
        
        .ticket-card {
            transition: all 0.3s ease;
        }
        
        .ticket-card:hover:not(:disabled) {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="text-white">
    <!-- Header -->
    <div class="bg-black/30 backdrop-blur-md shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2 flex items-center justify-center gap-3">
                    üéÅ Rifa Universitaria
                </h1>
                <p class="text-xl text-yellow-300 font-semibold mb-4">
                    Premio: ASUS TUF Gaming Ryzen 7 / RTX 3050
                </p>
                <p class="text-2xl font-bold text-green-400">
                    o $3.000.000 COP en efectivo (a elecci√≥n del ganador)
                </p>
                
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto">
                    <div class="bg-white/10 rounded-lg p-4">
                        <p class="text-sm text-gray-300">Valor boleta</p>
                        <p class="text-2xl font-bold">$20.000</p>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                        <p class="text-sm text-gray-300">Total boletas</p>
                        <p class="text-2xl font-bold">500</p>
                        <p class="text-xs text-gray-400 mt-1">2 n√∫meros por boleta</p>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                        <p class="text-sm text-gray-300">Sorteo</p>
                        <p class="text-lg font-bold">6 de diciembre 2024</p>
                        <p class="text-xs text-gray-300">Loter√≠a de Santander</p>
                    </div>
                </div>

                <div class="mt-6 bg-red-600/20 border-2 border-red-400 rounded-lg p-4 max-w-md mx-auto">
                    <div class="flex items-center justify-center gap-2 mb-2">
                        ‚è∞ <p class="text-sm font-semibold">Tiempo restante</p>
                    </div>
                    <p id="countdown" class="text-3xl font-mono font-bold">Calculando...</p>
                </div>

                <div class="mt-4 bg-blue-500/20 border border-blue-400 rounded-lg p-3 max-w-2xl mx-auto">
                    <p class="text-sm">
                        üí° <strong>¬°Doble oportunidad!</strong> Cada boleta incluye 2 n√∫meros (000-499 y 500-999)
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Estad√≠sticas -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-green-600/20 border border-green-400 rounded-lg p-4 text-center">
                <p id="availableCount" class="text-3xl font-bold">500</p>
                <p class="text-sm">Disponibles</p>
            </div>
            <div class="bg-yellow-600/20 border border-yellow-400 rounded-lg p-4 text-center">
                <p id="reservedCount" class="text-3xl font-bold">0</p>
                <p class="text-sm">Reservadas</p>
            </div>
            <div class="bg-red-600/20 border border-red-400 rounded-lg p-4 text-center">
                <p id="soldCount" class="text-3xl font-bold">0</p>
                <p class="text-sm">Vendidas</p>
            </div>
        </div>

        <!-- Grilla de boletas -->
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                üé´ Selecciona tu boleta
            </h2>
            <div id="ticketsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
                <!-- Las boletas se generar√°n con JavaScript -->
            </div>
        </div>

        <button onclick="showTerms()" class="w-full bg-white/10 hover:bg-white/20 rounded-lg p-4 mb-6 transition-all">
            üìã Ver T√©rminos y Condiciones
        </button>
    </div>

    <!-- Modal Formulario -->
    <div id="formModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-purple-800 to-blue-800 rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-2">
                Reservar Boleta #<span id="selectedTicketNum"></span>
            </h3>
            <p class="text-yellow-300 mb-4 text-sm">
                üìå N√∫meros: <strong><span id="selectedNumbers"></span></strong>
            </p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">Nombre completo</label>
                    <input type="text" id="inputName" class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 focus:border-yellow-400 focus:outline-none text-white">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Correo electr√≥nico</label>
                    <input type="email" id="inputEmail" class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 focus:border-yellow-400 focus:outline-none text-white">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Celular</label>
                    <input type="tel" id="inputPhone" placeholder="3103535483" class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 focus:border-yellow-400 focus:outline-none text-white">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">M√©todo de pago</label>
                    <select id="inputPayment" class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 focus:border-yellow-400 focus:outline-none text-white">
                        <option value="" style="color: #000;">Seleccionar...</option>
                        <option value="Nequi" style="color: #000;">Nequi</option>
                        <option value="Llaves" style="color: #000;">Llaves</option>
                        <option value="Efectivo" style="color: #000;">Efectivo</option>
                        <option value="Otro" style="color: #000;">Otro</option>
                    </select>

                    <!-- Informaci√≥n din√°mica seg√∫n m√©todo de pago -->
                    <div id="paymentInfo" class="mt-3 text-sm bg-white/10 rounded-lg p-3 hidden">
                        <div class="font-semibold mb-1">Instrucciones de pago</div>
                        <div id="paymentDetails" class="font-mono"></div>
                    </div>
                </div>

                <script>
                    // Mapea cada opci√≥n a las instrucciones / n√∫mero de cuenta que quieres mostrar
                    const paymentAccounts = {
                        Nequi: 'Nequi: 3167862046 (A nombre de Maria Martinez). Enviar comprobante por WhatsApp.',
                        Llaves: 'Llaves: 3167862046 (A nombre de Maria Martinez). Indica que es consignaci√≥n por la rifa.',
                        Efectivo: 'Efectivo: Pagar en punto de encuentro. Coordinar lugar y hora por WhatsApp.',
                        Otro: 'Otro: Por favor describe el m√©todo en el mensaje de WhatsApp y sube el comprobante.'
                    };

                    const paymentSelect = document.getElementById('inputPayment');
                    const paymentInfo = document.getElementById('paymentInfo');
                    const paymentDetails = document.getElementById('paymentDetails');

                    function updatePaymentInfo() {
                        const val = paymentSelect.value;
                        if (!val) {
                            paymentInfo.classList.add('hidden');
                            paymentDetails.textContent = '';
                            return;
                        }
                        paymentDetails.textContent = paymentAccounts[val] || '';
                        paymentInfo.classList.remove('hidden');
                    }

                    paymentSelect.addEventListener('change', updatePaymentInfo);

                    // Si el modal se cierra y se limpia el select, ocultamos tambi√©n el recuadro
                    // (esto cubre el caso de closeForm que pone inputPayment.value = '')
                    const observer = new MutationObserver(() => {
                        if (paymentSelect.value === '') updatePaymentInfo();
                    });
                    observer.observe(paymentSelect, { attributes: true, attributeFilter: ['value'] });

                    // Inicializa el estado si ya hay un valor seleccionado al abrir el modal
                    updatePaymentInfo();
                </script>

                <div class="bg-yellow-400/20 border border-yellow-400 rounded-lg p-4">
                    <label class="flex items-start gap-3 cursor-pointer">
                        <input type="checkbox" id="inputTerms" class="mt-1 w-5 h-5">
                        <span class="text-sm">
                            Acepto los t√©rminos y condiciones. Entiendo que tengo 24 horas para enviar el comprobante de pago y que el ganador puede elegir entre el port√°til o $3.000.000 COP en efectivo.
                        </span>
                    </label>
                </div>

                <div class="flex gap-3">
                    <button onclick="closeForm()" class="flex-1 bg-gray-600 hover:bg-gray-500 py-3 rounded-lg font-semibold transition-all">
                        Cancelar
                    </button>
                    <button onclick="submitReservation()" class="flex-1 bg-green-600 hover:bg-green-500 py-3 rounded-lg font-semibold transition-all">
                        Reservar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal T√©rminos -->
    <div id="termsModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
        <div class="bg-white text-gray-900 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-4">T√©rminos y Condiciones</h3>
            
            <div class="space-y-4 text-sm">
                <section>
                    <h4 class="font-bold text-lg mb-2">1. Del Premio</h4>
                    <p>El ganador podr√° elegir entre:</p>
                    <ul class="list-disc ml-6 mt-2">
                        <li>Port√°til ASUS TUF Gaming Ryzen 7 / RTX 3050</li>
                        <li>$3.000.000 COP en efectivo</li>
                    </ul>
                    <p class="mt-2">La elecci√≥n debe realizarse en un plazo m√°ximo de 48 horas despu√©s del sorteo.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">2. De las Boletas</h4>
                    <p>Cada boleta incluye 2 n√∫meros autom√°ticamente asignados:</p>
                    <ul class="list-disc ml-6 mt-2">
                        <li>Boleta #1 incluye n√∫meros 000 y 500</li>
                        <li>Boleta #2 incluye n√∫meros 001 y 501</li>
                        <li>Y as√≠ sucesivamente hasta la Boleta #500 con n√∫meros 499 y 999</li>
                    </ul>
                    <p class="mt-2">Esto significa que con una sola boleta participas con dos n√∫meros en el sorteo, duplicando tus oportunidades de ganar.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">3. De la Reserva</h4>
                    <p>Al reservar una boleta, el comprador tiene 24 horas para enviar el comprobante de pago al WhatsApp indicado. Si no se recibe el comprobante en ese plazo, la reserva ser√° liberada autom√°ticamente.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">4. Del Sorteo</h4>
                    <p>El sorteo se realizar√° el 6 de diciembre de 2024, siguiendo los resultados de la Loter√≠a de Santander. El n√∫mero ganador corresponder√° a las √∫ltimas 3 cifras del premio mayor.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">5. De la Entrega</h4>
                    <p>El premio ser√° entregado dentro de los 5 d√≠as h√°biles siguientes al sorteo, previa validaci√≥n del boleto ganador y presentaci√≥n de documento de identidad.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">6. Responsabilidad</h4>
                    <p>Los organizadores no se hacen responsables por informaci√≥n err√≥nea proporcionada por el participante. Es responsabilidad del comprador conservar su comprobante de pago.</p>
                </section>

                <section>
                    <h4 class="font-bold text-lg mb-2">7. Validez</h4>
                    <p>Solo participan boletas debidamente pagadas y confirmadas por los organizadores antes de la fecha del sorteo.</p>
                </section>
            </div>

            <button onclick="closeTerms()" class="w-full mt-6 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-semibold transition-all">
                Cerrar
            </button>
        </div>
    </div>

    <!-- Modal √âxito -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
        <div class="bg-green-600 rounded-xl p-8 max-w-md w-full text-center">
            <div class="text-6xl mb-4 animate-bounce">‚úÖ</div>
            <h3 class="text-2xl font-bold mb-4">Reserva Registrada</h3>
            <div class="bg-white/20 rounded-lg p-3 mb-4">
                <p class="font-bold">Boleta #<span id="successTicketNum"></span></p>
                <p class="text-sm">N√∫meros: <span id="successNumbers"></span></p>
            </div>
            <p class="mb-4">
                Env√≠a tu comprobante al WhatsApp <strong id="whatsappDisplay"></strong> para validar tu participaci√≥n.
            </p>
            <p class="text-sm bg-white/20 rounded-lg p-3">
                Tienes 2 horas para enviar el comprobante; si no se recibe, la reserva ser√° liberada.
            </p>
        </div>
    </div>

    <!-- Footer -->
    <div class="max-w-7xl mx-auto px-4 py-6 text-center text-sm text-gray-400">
        <p>Rifa Universitaria 2024 ‚Ä¢ Todas las transacciones deben ser validadas</p>
        <p class="mt-2">WhatsApp: <span id="footerWhatsapp"></span></p>
    </div>

    <script>
        // ‚ö†Ô∏è CONFIGURACI√ìN - CAMBIAR ESTOS VALORES
        const WHATSAPP_NUMBER = '573151371553'; // Cambiar por tu n√∫mero
        const DRAW_DATE = new Date('2025-12-06T20:00:00');
        const TICKET_PRICE = 20000;
        const TOTAL_TICKETS = 500;

        // Estado de las boletas
        let tickets = [];
        let selectedTicket = null;

        // Inicializar boletas
        function initTickets() {
            tickets = [];
            for (let i = 0; i < TOTAL_TICKETS; i++) {
                const ticketNum = i + 1;
                const firstNumber = String(i).padStart(3, '0');
                const secondNumber = String(999 - i).padStart(3, '0');
                
                tickets.push({
                    ticketNumber: ticketNum,
                    numbers: [firstNumber, secondNumber],
                    status: 'available',
                    buyer: null,
                    reservedAt: null
                });
            }
            renderTickets();
            updateStats();
        }

        // Renderizar boletas
        function renderTickets() {
            const grid = document.getElementById('ticketsGrid');
            grid.innerHTML = '';
            
            tickets.forEach(ticket => {
                const button = document.createElement('button');
                button.className = `ticket-card rounded-lg p-4 font-bold transition-all text-left ${
                    ticket.status === 'available' 
                        ? 'bg-green-500 hover:bg-green-400 cursor-pointer shadow-lg' 
                        : ticket.status === 'reserved'
                        ? 'bg-yellow-600 cursor-not-allowed opacity-60'
                        : 'bg-red-600 cursor-not-allowed opacity-60'
                }`;
                
                button.disabled = ticket.status !== 'available';
                button.onclick = () => openForm(ticket);
                
                button.innerHTML = `
                    <div class="text-lg mb-1">Boleta #${ticket.ticketNumber}</div>
                    <div class="text-sm font-normal opacity-90">
                        üìå ${ticket.numbers[0]} y ${ticket.numbers[1]}
                    </div>
                `;
                
                grid.appendChild(button);
            });
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const available = tickets.filter(t => t.status === 'available').length;
            const reserved = tickets.filter(t => t.status === 'reserved').length;
            const sold = tickets.filter(t => t.status === 'sold').length;
            
            document.getElementById('availableCount').textContent = available;
            document.getElementById('reservedCount').textContent = reserved;
            document.getElementById('soldCount').textContent = sold;
        }

        // Abrir formulario
        function openForm(ticket) {
            selectedTicket = ticket;
            document.getElementById('selectedTicketNum').textContent = ticket.ticketNumber;
            document.getElementById('selectedNumbers').textContent = `${ticket.numbers[0]} y ${ticket.numbers[1]}`;
            document.getElementById('formModal').classList.remove('hidden');
        }

        // Cerrar formulario
        function closeForm() {
            document.getElementById('formModal').classList.add('hidden');
            selectedTicket = null;
            // Limpiar campos
            document.getElementById('inputName').value = '';
            document.getElementById('inputEmail').value = '';
            document.getElementById('inputPhone').value = '';
            document.getElementById('inputPayment').value = '';
            document.getElementById('inputTerms').checked = false;
        }

        // Enviar reserva
        function submitReservation() {
            const name = document.getElementById('inputName').value;
            const email = document.getElementById('inputEmail').value;
            const phone = document.getElementById('inputPhone').value;
            const payment = document.getElementById('inputPayment').value;
            const terms = document.getElementById('inputTerms').checked;
            
            if (!name || !email || !phone || !payment) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            if (!terms) {
                alert('Debes aceptar los t√©rminos y condiciones');
                return;
            }
            
            // Actualizar estado del ticket
            const ticketIndex = tickets.findIndex(t => t.ticketNumber === selectedTicket.ticketNumber);
            tickets[ticketIndex].status = 'reserved';
            tickets[ticketIndex].buyer = { name, email, phone, payment };
            tickets[ticketIndex].reservedAt = new Date().toISOString();
            
            // Mostrar modal de √©xito
            document.getElementById('successTicketNum').textContent = selectedTicket.ticketNumber;
            document.getElementById('successNumbers').textContent = `${selectedTicket.numbers[0]} y ${selectedTicket.numbers[1]}`;
            document.getElementById('successModal').classList.remove('hidden');
            
            // Crear mensaje de WhatsApp
            const message = `Hola Emil! Reserv√© la Boleta #${selectedTicket.ticketNumber} de la rifa del port√°til gamer.\n\nüìå N√∫meros: ${selectedTicket.numbers[0]} y ${selectedTicket.numbers[1]}\n\nDatos:\nNombre: ${name}\nCorreo: ${email}\nCelular: ${phone}\nM√©todo de pago: ${payment}\n\nEnv√≠o mi comprobante de pago de $${TICKET_PRICE.toLocaleString('es-CO')} COP.`;
            
            // Abrir WhatsApp despu√©s de 2 segundos
            setTimeout(() => {
                window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
            }, 2000);
            
            // Cerrar modales despu√©s de 5 segundos
            setTimeout(() => {
                document.getElementById('successModal').classList.add('hidden');
                closeForm();
                renderTickets();
                updateStats();
            }, 5000);
        }

        // Mostrar t√©rminos
        function showTerms() {
            document.getElementById('termsModal').classList.remove('hidden');
        }

        // Cerrar t√©rminos
        function closeTerms() {
            document.getElementById('termsModal').classList.add('hidden');
        }

        // Contador regresivo
        function updateCountdown() {
            const now = new Date();
            const diff = DRAW_DATE - now;
            
            if (diff <= 0) {
                document.getElementById('countdown').textContent = '¬°Sorteo finalizado!';
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        // Verificar reservas expiradas (24 horas)
        function checkExpiredReservations() {
            const now = new Date();
            tickets.forEach(ticket => {
                if (ticket.status === 'reserved' && ticket.reservedAt) {
                    const reservedTime = new Date(ticket.reservedAt);
                    const hoursPassed = (now - reservedTime) / (1000 * 60 * 60);
                    if (hoursPassed >= 24) {
                        ticket.status = 'available';
                        ticket.buyer = null;
                        ticket.reservedAt = null;
                    }
                }
            });
            renderTickets();
            updateStats();
        }

        // Mostrar n√∫mero de WhatsApp en footer
        document.getElementById('footerWhatsapp').textContent = `+57 ${WHATSAPP_NUMBER.slice(2)}`;
        document.getElementById('whatsappDisplay').textContent = `+57 ${WHATSAPP_NUMBER.slice(2)}`;

        // Inicializar
        initTickets();
        updateCountdown();
        setInterval(updateCountdown, 1000);
        setInterval(checkExpiredReservations, 60000); // Cada minuto
    </script>
</body>
</html>